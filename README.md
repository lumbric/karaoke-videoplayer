# Karaoke ab Hof üé§

A local web-based karaoke video player application originally built for the festival ["Kultur ab Hof"](https://kulturabhof.at/).

![Screenshot](screenshot.png)

## What is this?

- A Web application to browse a local collection of karaoke video songs and play them.
- Search-as-you-type for song title or artist name.
- Play videos in a full-window experience (ideal for kiosk mode).
- Built‚Äëin statistics: what was played, how often, completion vs. aborts, plus simple charts.
- Optimized for large screens; responsive layout also works on smaller screens.

**Why offline?** This app was designed for the "Kultur ab Hof" festival where internet connectivity is limited or unavailable. Instead of relying on YouTube or streaming services, it uses a local collection of karaoke videos that work completely offline.

## How to Use

1. Collect songs / video files (you can use https://github.com/yt-dlp/yt-dlp).
2. Generate JSON metadata and download cover art.
3. Start a browser via a local web server (recommended) or allow local file access in your browser.

```bash
# 1. Clone the repository
git clone https://github.com/lumbric/karaoke-videoplayer/
cd karaoke-videoplayer

# 2. Create videos folder and add your MP4 files
mkdir videos

# Put your MP4 karaoke videos in the "videos" folder, file names will be used for metadata search queries

# To download videos you can do so using yt-dlp
# pip install yt-dlp
# for f in $(cat song-list); do yt-dlp --format mp4 $f; done  # one youtube link per line in the file "song-list"

# 3. Generate metadata and covers (requires ffprobe and spotdl; see notes below)
./update-song-data.py  
# If you're fully offline, you can still add files & durations:
# ./update-song-data.py --no-internet

# 4. Start a web server of your choice
# This step can be omitted if you enable direct file access in your browser (see below).
python3 -m http.server 8000

# 5. Open browser
# Navigate to http://localhost:8000
```

You can use the included script to start a web server and open the browser in kiosk mode:

```bash
chmod +x start.sh
./start.sh
```

Note that users can still leave the browser (e.g., Alt+F4, Alt+Tab).


### Web browser allow local file access

Modern browsers block direct file access for security reasons (CORS policy). When you open an HTML file directly (`file://` protocol), the browser may block loading local videos and JSON files.

There are two ways to avoid these restrictions:

- Run a local web server (`http://` protocol), e.g. `python3 -m http.server 8000` or lighttpd/nginx.
- Allow local file access in your browser by trusting the local files:
    - Chromium/Chrome: launch with `--allow-file-access-from-files` and open `index.html` via `file://`.
    - Firefox: set `about:config` ‚Üí `security.fileuri.strict_origin_policy` to `false`.

Using a web server is recommended because it scopes access to a specific folder and avoids CORS issues.


## How it works

The app is a single HTML file (`index.html`) that loads a JSON file (`videos.json`) listing available songs. Each entry provides metadata for search (artist/title), duration (used for stats), and cover art.

Statistics are stored locally in your browser (localStorage) and reflect activity on the current device/browser only. Use the ‚ÄúExport Data‚Äù button on the stats page to download a JSON snapshot.

## Scripts

update-song-data.py

- Scans `videos/` for video files, writes `videos.json` and `extra_metadata.json`.
- Retrieves metadata (artist, title, genres) and cover art via `spotdl` when internet is available.
- Extracts video duration via `ffprobe` (part of ffmpeg).

Requirements to use all features:
- Python 3.8+ with `requests` (`pip install requests`)
- ffmpeg/ffprobe installed and on PATH
- spotdl CLI installed (`pipx install spotdl` or `pip install spotdl`)

## File Structure

```
karaoke-videoplayer/
‚îú‚îÄ‚îÄ videos/                  # Your MP4 karaoke videos go here
‚îú‚îÄ‚îÄ covers/                  # Cover images (auto-generated by update-song-data.py)
‚îú‚îÄ‚îÄ static/                  # App assets
‚îÇ   ‚îú‚îÄ‚îÄ singing-chicken.png  # Decorative image / logo
‚îÇ   ‚îú‚îÄ‚îÄ RocknRollOne.ttf     # Custom font, similar to the font on the poster of Kultur ab Hof
‚îÇ   ‚îî‚îÄ‚îÄ chart.js             # Statistics charts JS library
‚îú‚îÄ‚îÄ index.html               # Main application
‚îú‚îÄ‚îÄ start.sh                 # Quick start script for Http server and browser in Kiosk mode
‚îú‚îÄ‚îÄ update-song-data.py      # Metadata generation and cover download script
‚îú‚îÄ‚îÄ extra_metadata.json      # Extra metadata downloaded via spotdl (cover URL, lyrics, ...) ‚Äî not used by the web app
‚îî‚îÄ‚îÄ videos.json              # Video metadata (auto-generated)
```

### Files

**videos.json (required):**

List of your songs. Only `filename` and `duration_seconds` are required by the app. If no `artist/title` are given, the filename (without extension) will be shown.

By default, the app derives paths as:
  - video file: `videos/{filename}.mp4`
  - cover image: `covers/{filename}.jpg`

To override paths (e.g., different extensions or custom names), set the optional fields:
  - `file`: full/relative path to the video file
  - `cover`: full/relative path to the cover image

Example:

```json
[
  {
    "filename": "Die √Ñrzte - Schrei nach Liebe",
    "duration_seconds": 273.25,
    "artist": "Die √Ñrzte",
    "title": "Schrei nach Liebe",
    "genre": [
      "neue deutsche welle",
      "german pop"
    ],
    "has_cover": true,
    "processed_at": "2025-08-08T10:36:55Z"
  },
  {
    "filename": "Green Day - Basket Case (karaoke)",
    "duration_seconds": 186.5,
    "artist": "Ameritz - Karaoke",
    "title": "Basket Case (In the Style of Green Day) [Karaoke Version]",
  "file": "videos/Green Day - Basket Case (karaoke).mp4",
  "cover": "covers/Green Day - Basket Case (karaoke).jpg",
    "has_cover": true,
    "processed_at": "2025-08-08T10:36:55Z"
  }
]
  ```

**extra_metadata.json (optional):**
Produced by `update-song-data.py` with extended info (what spotdl provides). Kept to re-generate `videos.json` or to look up details (e.g., lyrics). Not used by the web app, only by the update script. You can remove songs from `videos.json` without deleting their metadata here.

**Video files (MP4):**
Karaoke video files in `videos/`. One song per file. Ideally named `Artist - Title.mp4` ‚Äî the base name is used to search for cover art and metadata.

**cover art:**
JPEGs in `covers/`. Covers are downloaded/generated by `update-song-data.py` when internet is available; otherwise the app shows a default cover.


### Controls
- **Search**: Type in the search box to filter songs
- **Play Video**: Click any song card to start playing
- **Fullscreen**: Videos fill the window (good for kiosk mode)
- **Player Controls**: 
  - ‚úï button to close/exit fullscreen
  - ‚è∏ Pause/‚ñ∂ Play button
  - ‚Üª Restart button to replay from beginning
- **Statistics**: Click the chart button to view song popularity and usage stats

### Keyboard Shortcuts
- **ESC**: Clear search (when no video is playing) or exit fullscreen
- **Ctrl+K / Cmd+K**: Clear search
- **Ctrl+K / Cmd+K**: Clear search