<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>Karaoke ab Hof üé§</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=RocknRoll+One&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      margin: 0;
      font-family: 'RocknRoll One', sans-serif;
      background: #332e5d;
      min-height: 100vh;
      color: white;
      overflow-x: hidden;
      line-height: 1.4;
      position: relative;
    }

    h1 {
      text-align: center;
      margin: 1em 0 0.5em 0;
      font-size: 4em;
      color: #cd6391;
      font-weight: bolder;
      position: relative;
      z-index: 1;
      letter-spacing: 2px;
    }

    /*
    h1::before,
    h1::after {
      content: '‚ú®';
      font-size: 0.6em;
      color: #ff1493;
      margin: 0 20px;
      text-shadow: 2px 2px 4px rgba(46, 37, 92, 0.3);
    }
    */

    #search {
      margin: 1.5em auto 2em auto;
      display: block;
      padding: 1em 1.5em;
      width: min(600px, 80%);
      font-size: 1.2em;
      font-family: 'RocknRoll One', sans-serif;
      border: 0px;
      border-radius: 25px;
      background: white;
      color: #4E4E4E;
      text-align: center;
      transition: all 0.1s ease;
      outline: none;
      position: relative;
      z-index: 1;
    }
    #search:focus {
      transform: scale(1.06);
    }
    #search::placeholder {
      text-align: center;
      color: #a791b5;
    }
    .search-info {
      display: none;
    }

    .video-grid {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 25px;
      padding: 20px 40px;
      max-width: 1400px;
      margin: 0 auto;
    }

    .card {
      background: #cd6391;
      border: 0px;
      border-radius: 15px;
      padding: 15px;
      width: 250px;
      cursor: pointer;
      transition: all 0.2s ease;
      position: relative;
      z-index: 1;
    }


    .card:hover {
      transform: scale(1.08) translateY(0px);
    }

    .card img {
      width: 100%;
      height: 250px;
      object-fit: cover;
      border-radius: 15px;
      border: 0px;
    }

    .title {
      margin-top: 1em;
      font-weight: bold;
      font-size: 1.1em;
      text-align: center;
      color: white;
    }

    #playerContainer {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background-color: #000;
      justify-content: center;
      align-items: center;
      z-index: 1000;
      cursor: none;
    }

    #playerContainer.show-cursor {
      cursor: default;
    }

    video {
        width: 100vw;
        height: 100vh;
        object-fit: contain;
        background: #000;
    }

    button {
      background: #44467f;
      color: white;
      font-family: 'RocknRoll One', sans-serif;
      padding: 15px 20px;
      border: 0px;
      color: white;
      border-radius: 15px;
      cursor: pointer;
      font-size: 0.9em;
      transition: all 0.3s ease;
    }

    button:hover {
        background: #cd6391;
    }

    #closeBtn {
      position: absolute;
      top: 20px;
      left: 20px;
      padding: 12px 16px;
      font-size: 1.2em;
      display: none;
      z-index: 1001;
      opacity: 0;
      transition: opacity 0.3s ease;
    }

    #closeBtn.visible {
      opacity: 1;
    }

    #statsButton {
      position: fixed;
      bottom: 20px;
      right: 20px;
      z-index: 10;
    }

    #statsPage {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
      z-index: 2000;
      padding: 20px;
      box-sizing: border-box;
      overflow-y: auto;
    }

    .stat-card {
      background: linear-gradient(145deg, #cd6391 0%, #b8578a 100%);
      padding: 20px;
      border-radius: 15px;
      text-align: center;
      box-shadow: 0 8px 32px rgba(205, 99, 145, 0.3);
      border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .stat-card h3 {
      margin: 0 0 10px 0;
      font-size: 1em;
      color: white;
      opacity: 0.9;
    }

    .stat-number {
      font-size: 1.8em;
      font-weight: bold;
      color: white;
      text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
    }

    .chart-container {
      background: rgba(255, 255, 255, 0.05);
      padding: 20px;
      border-radius: 15px;
      border: 1px solid rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(10px);
    }

    .chart-container h3 {
      margin: 0 0 15px 0;
      color: #cd6391;
      font-size: 1.2em;
      text-align: center;
    }

    .favorite-item, .activity-item {
      background: rgba(205, 99, 145, 0.2);
      margin: 8px 0;
      padding: 12px;
      border-radius: 8px;
      border-left: 4px solid #cd6391;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .favorite-item .song-title, .activity-item .song-title {
      font-weight: bold;
      color: white;
    }

    .favorite-item .completion, .activity-item .time {
      color: #cd6391;
      font-size: 0.9em;
    }

    #closeStats {
      position: absolute;
      top: 10px;
      right: 10px;
    }

    /* Static cosmic/party decorative elements (no animations) */
    .cosmic-decoration {
      position: fixed;
      font-size: 2em;
      opacity: 0.15;
      z-index: 0;
      pointer-events: none;
      color: #ff69b4;
    }

    .cosmic-decoration:nth-child(1) { top: 10%; left: 5%; }
    .cosmic-decoration:nth-child(2) { top: 20%; right: 8%; }
    .cosmic-decoration:nth-child(3) { bottom: 15%; left: 10%; }
    .cosmic-decoration:nth-child(4) { bottom: 25%; right: 15%; }

    .header-box {
        position: relative;
        width:1000px;
        margin:auto;
    }

    .singing-chicken {
        position: fixed;
        left: 20px;
        top: 10px;
        width: 400px;
    }

    /* Responsive Design */

    @media (max-width: 2000px) {
        .singing-chicken {
          position: absolute;
          left: -90px;
          top:-10px;
          width: 220px;
        }
    }

    @media (max-width: 1275px) {
        .singing-chicken {
            display: none;
        }
    }

    @media (max-width: 768px) {
      .video-grid {
        padding: 20px 20px;
        gap: 20px;
        justify-content: center;
      }
      .card {
        width: 200px;
      }
      .card img {
        height: 200px;
      }
      h1 {
        font-size: 2.2em;
      }
      h1::before,
      h1::after {
        font-size: 0.5em;
        margin: 0 15px;
      }
      #search {
        width: 90%;
        font-size: 1.1em;
        padding: 0.8em 1.2em;
      }
      .cosmic-decoration {
        display: none;
      }
      
      /* Statistics responsive */
      #statsPage div[style*="grid-template-columns: 1fr 1fr"] {
        display: block !important;
      }
      .chart-container {
        margin-bottom: 20px;
      }
    }

    @media (max-width: 480px) {
      .video-grid {
        padding: 15px 15px;
        gap: 15px;
      }
      .card {
        width: 160px;
      }
      .card img {
        height: 160px;
      }
      h1 {
        font-size: 1.8em;
      }
      h1::before,
      h1::after {
        font-size: 0.4em;
        margin: 0 10px;
      }
      #search {
        font-size: 1em;
        padding: 0.7em 1em;
      }
    }
  </style>
</head>
<body>
  <!-- Cosmic/party decorative background elements -->
  <div class="cosmic-decoration" style="top: 10%; left: 5%;">üéµ</div>
  <div class="cosmic-decoration" style="top: 20%; right: 8%;">‚≠ê</div>
  <div class="cosmic-decoration" style="bottom: 15%; left: 10%;">üé§</div>
  <div class="cosmic-decoration" style="bottom: 25%; right: 15%;">üé∂</div>

  <div class="header-box">
    <h1>Karaoke ab Hof üé§</h1>
    <img src="images/singing-chicken.png" class="singing-chicken">
  </div>
  <input type="text" id="search" placeholder="Lied suchen...">
  <div class="video-grid" id="videoList"></div>
  <div id="playerContainer">
    <video id="videoPlayer" controls autoplay></video>
    <button id="closeBtn" onclick="closePlayer()">‚Üê Zur√ºck</button>
  </div>
  <button id="statsButton">üìä Statistik</button>
  <div id="statsPage">
    <button id="closeStats">‚úï</button>
    <div style="padding: 20px; max-width: 1200px; margin: 0 auto;">
      <h2 style="color: #cd6391; text-align: center; margin-bottom: 30px; font-size: 2.5em;">üìä Karaoke Statistiken</h2>
      
      <!-- Statistics Summary Cards -->
      <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 40px;">
        <div class="stat-card">
          <h3>üéµ Total Songs</h3>
          <div class="stat-number" id="totalSongs">0</div>
        </div>
        <div class="stat-card">
          <h3>‚è±Ô∏è Total Play Time</h3>
          <div class="stat-number" id="totalPlayTime">0min</div>
        </div>
        <div class="stat-card">
          <h3>üèÜ Most Played</h3>
          <div class="stat-number" id="mostPlayed">-</div>
        </div>
        <div class="stat-card">
          <h3>üìà Completion Rate</h3>
          <div class="stat-number" id="completionRate">0%</div>
        </div>
      </div>

      <!-- Charts Container -->
      <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin-bottom: 30px;">
        <div class="chart-container">
          <h3>üé§ Most Played Songs (Top 10)</h3>
          <canvas id="mostPlayedChart" width="400" height="300"></canvas>
        </div>
        <div class="chart-container">
          <h3>üïí Play Time Distribution</h3>
          <canvas id="playTimeChart" width="400" height="300"></canvas>
        </div>
      </div>

      <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin-bottom: 30px;">
        <div class="chart-container">
          <h3>‚≠ê Favorite Songs (>80% completion)</h3>
          <div id="favoritesList" style="max-height: 300px; overflow-y: auto;"></div>
        </div>
        <div class="chart-container">
          <h3>üìÖ Activity Over Time</h3>
          <canvas id="activityChart" width="400" height="300"></canvas>
        </div>
      </div>

      <!-- Recent Activity -->
      <div class="chart-container">
        <h3>üïê Recent Activity</h3>
        <div id="recentActivity" style="max-height: 200px; overflow-y: auto;"></div>
      </div>

      <div style="text-align: center; margin-top: 30px;">
        <button onclick="exportStats()" style="margin-right: 10px;">üìÅ Export Data</button>
        <button onclick="clearStats()" style="background: #d32f2f;">üóëÔ∏è Clear All Data</button>
      </div>
    </div>
  </div>
  <script>
    let allVideos = [];
    let playedLog = JSON.parse(localStorage.getItem("playedLog") || "[]");
    let chartInstance = null;

    // Configuration for video display and search
    const CONFIG = {
      MAX_DISPLAY_COUNT: 50       // Maximum number of videos to display (both start page and search results)
    };

    async function loadVideos() {
      try {
        const res = await fetch("videos.json");
        allVideos = await res.json();
        showRandomVideos();
      } catch (error) {
        console.error("Error loading videos:", error);
      }
    }

    function showRandomVideos() {
      const sample = shuffle([...allVideos]).slice(0, CONFIG.MAX_DISPLAY_COUNT);
      renderCards(sample);
    }

    function shuffle(arr) {
      for (let i = arr.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [arr[i], arr[j]] = [arr[j], arr[i]];
      }
      return arr;
    }

    function renderCards(videos) {
      const container = document.getElementById("videoList");
      container.innerHTML = "";

      if (videos.length === 0) {
        container.innerHTML = '<div style="text-align: center; color: #ccc; padding: 2em;">Keine Videos gefunden</div>';
        return;
      }

      videos.forEach(v => {
        const div = document.createElement("div");
        div.className = "card";
        div.innerHTML = `<img src="${v.cover}" onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjEyMCIgdmlld0JveD0iMCAwIDIwMCAxMjAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIyMDAiIGhlaWdodD0iMTIwIiBmaWxsPSIjNDQ0Ii8+Cjx0ZXh0IHg9IjEwMCIgeT0iNjAiIGZpbGw9IiNjY2MiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGR5PSIwLjNlbSI+S2VpbiBCaWxkPC90ZXh0Pgo8L3N2Zz4='"><div class="title">${v.title}</div>`;
        div.onclick = () => playVideo(v);
        container.appendChild(div);
      });
    }



    function handleSearch(query) {
      if (!query || query.length === 0) {
        // Show random videos when search is empty
        showRandomVideos();
        return;
      }

      // Filter videos based on search query (search starts immediately with any character)
      const filteredVideos = allVideos.filter(v =>
        v.title.toLowerCase().includes(query.toLowerCase())
      );

      if (filteredVideos.length === 0) {
        renderCards([]);
        return;
      }

      // Limit results to same number as start page
      const limitedResults = filteredVideos.slice(0, CONFIG.MAX_DISPLAY_COUNT);
      renderCards(limitedResults);
    }

    function playVideo(video) {
      const player = document.getElementById("videoPlayer");
      const container = document.getElementById("playerContainer");
      const btn = document.getElementById("closeBtn");

      player.src = video.file;
      container.style.display = "flex";
      btn.style.display = "block";

      // Hide cursor and button initially
      container.classList.remove("show-cursor");
      btn.classList.remove("visible");

      const startTime = Date.now();
      let playStartTime = 0;
      let totalDuration = 0;
      let ended = false;

      // Get video duration when metadata loads
      player.onloadedmetadata = () => {
        totalDuration = player.duration;
        playStartTime = player.currentTime;
      };

      player.onended = () => {
        ended = true;
        const playedSeconds = player.currentTime - playStartTime;
        logPlay(video.title, startTime, playedSeconds, totalDuration, true);
        closePlayer();
      };

      player.onpause = () => {
        if (!ended) {
          const playedSeconds = player.currentTime - playStartTime;
          logPlay(video.title, startTime, playedSeconds, totalDuration, false);
        }
      };

      // Initial log entry
      logPlay(video.title, startTime, 0, 0, false);
    }

    function closePlayer() {
      const player = document.getElementById("videoPlayer");
      const container = document.getElementById("playerContainer");
      const btn = document.getElementById("closeBtn");

      player.pause();
      player.src = "";
      container.style.display = "none";

      // Reset cursor and button state
      container.classList.remove("show-cursor");
      btn.classList.remove("visible");
    }

    function logPlay(title, timestamp, playedSeconds, totalDuration, completed) {
      playedLog.push({ 
        title, 
        timestamp, 
        playedSeconds: Math.round(playedSeconds), 
        totalDuration: Math.round(totalDuration), 
        completed,
        playPercentage: totalDuration > 0 ? Math.round((playedSeconds / totalDuration) * 100) : 0
      });
      localStorage.setItem("playedLog", JSON.stringify(playedLog));
    }

    // Enhanced search with intelligent filtering
    document.getElementById("search").addEventListener("input", e => {
      const query = e.target.value.trim();
      handleSearch(query);
    });

    // Mouse movement handling for video player
    document.addEventListener("mousemove", () => {
      const container = document.getElementById("playerContainer");
      const btn = document.getElementById("closeBtn");

      if (container.style.display === "flex") {
        // Show cursor and button on mouse movement
        container.classList.add("show-cursor");
        btn.classList.add("visible");

        // Hide again after 3 seconds of no movement
        clearTimeout(window.hideTimer);
        window.hideTimer = setTimeout(() => {
          container.classList.remove("show-cursor");
          btn.classList.remove("visible");
        }, 3000);
      }
    });

    // Keyboard shortcuts
    document.addEventListener("keydown", e => {
      const playerContainer = document.getElementById("playerContainer");
      const statsPage = document.getElementById("statsPage");
      const searchField = document.getElementById("search");

      if (e.key === "Escape") {
        // If video is playing, close it
        if (playerContainer.style.display === "flex") {
          closePlayer();
        }
        // If stats page is open, close it
        else if (statsPage.style.display === "block") {
          statsPage.style.display = "none";
        }
        // If neither video nor stats are open, clear search field
        else {
          searchField.value = "";
          showRandomVideos();
        }
      }
      // Clear search with Ctrl+K or Cmd+K
      if ((e.ctrlKey || e.metaKey) && e.key === "k") {
        e.preventDefault();
        searchField.value = "";
        showRandomVideos();
        searchField.focus();
      }
    });

    // Statistics functionality
    document.getElementById("statsButton").onclick = () => {
      document.getElementById("statsPage").style.display = "block";
      renderChart();
    };

    document.getElementById("closeStats").onclick = () => {
      document.getElementById("statsPage").style.display = "none";
    };

    function exportStats() {
      const logs = JSON.parse(localStorage.getItem("playedLog") || "[]");
      const blob = new Blob([JSON.stringify(logs, null, 2)], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "karaoke_stats.json";
      a.click();
      URL.revokeObjectURL(url);
    }

    function renderChart() {
      const logs = JSON.parse(localStorage.getItem("playedLog") || "[]");
      
      if (logs.length === 0) {
        document.getElementById('totalSongs').textContent = '0';
        document.getElementById('totalPlayTime').textContent = '0min';
        document.getElementById('mostPlayed').textContent = '-';
        document.getElementById('completionRate').textContent = '0%';
        return;
      }

      // Calculate statistics
      const stats = calculateStatistics(logs);
      
      // Update summary cards
      updateSummaryCards(stats);
      
      // Render charts
      renderMostPlayedChart(stats.mostPlayedSongs);
      renderPlayTimeChart(stats.playTimeDistribution);
      renderActivityChart(stats.dailyActivity);
      renderFavoritesList(stats.favoriteSongs);
      renderRecentActivity(logs.slice(-10).reverse());
    }

    function calculateStatistics(logs) {
      const songStats = {};
      const dailyActivity = {};
      let totalPlayTime = 0;
      let completedSongs = 0;

      logs.forEach(log => {
        if (!songStats[log.title]) {
          songStats[log.title] = {
            playCount: 0,
            totalPlayTime: 0,
            totalDuration: 0,
            completions: 0,
            avgCompletion: 0
          };
        }

        const song = songStats[log.title];
        song.playCount++;
        song.totalPlayTime += log.playedSeconds || 0;
        if (log.totalDuration > 0) song.totalDuration = log.totalDuration;
        if (log.completed) song.completions++;

        totalPlayTime += log.playedSeconds || 0;
        if (log.completed) completedSongs++;

        // Daily activity
        const date = new Date(log.timestamp).toDateString();
        dailyActivity[date] = (dailyActivity[date] || 0) + 1;
      });

      // Calculate average completion rates
      Object.keys(songStats).forEach(title => {
        const song = songStats[title];
        song.avgCompletion = song.playCount > 0 ? (song.completions / song.playCount) * 100 : 0;
      });

      // Get most played songs (top 10)
      const mostPlayedSongs = Object.entries(songStats)
        .sort(([,a], [,b]) => b.playCount - a.playCount)
        .slice(0, 10);

      // Get favorite songs (>80% completion rate, min 2 plays)
      const favoriteSongs = Object.entries(songStats)
        .filter(([,song]) => song.avgCompletion > 80 && song.playCount >= 2)
        .sort(([,a], [,b]) => b.avgCompletion - a.avgCompletion)
        .slice(0, 10);

      // Play time distribution
      const playTimeRanges = {
        '0-25%': 0,
        '26-50%': 0,
        '51-75%': 0,
        '76-100%': 0
      };

      logs.forEach(log => {
        if (log.playPercentage <= 25) playTimeRanges['0-25%']++;
        else if (log.playPercentage <= 50) playTimeRanges['26-50%']++;
        else if (log.playPercentage <= 75) playTimeRanges['51-75%']++;
        else playTimeRanges['76-100%']++;
      });

      return {
        totalSongs: Object.keys(songStats).length,
        totalPlayTime: Math.round(totalPlayTime / 60),
        mostPlayedSong: mostPlayedSongs[0] ? mostPlayedSongs[0][0] : '-',
        completionRate: Math.round((completedSongs / logs.length) * 100),
        mostPlayedSongs,
        favoriteSongs,
        playTimeDistribution: playTimeRanges,
        dailyActivity
      };
    }

    function updateSummaryCards(stats) {
      document.getElementById('totalSongs').textContent = stats.totalSongs;
      document.getElementById('totalPlayTime').textContent = `${stats.totalPlayTime}min`;
      document.getElementById('mostPlayed').textContent = stats.mostPlayedSong;
      document.getElementById('completionRate').textContent = `${stats.completionRate}%`;
    }

    function renderMostPlayedChart(mostPlayedSongs) {
      const ctx = document.getElementById('mostPlayedChart').getContext('2d');
      
      if (window.mostPlayedChartInstance) window.mostPlayedChartInstance.destroy();
      
      if (mostPlayedSongs.length === 0) {
        ctx.fillStyle = '#fff';
        ctx.font = '16px sans-serif';
        ctx.textAlign = 'center';
        ctx.fillText('No data available', ctx.canvas.width / 2, ctx.canvas.height / 2);
        return;
      }

      window.mostPlayedChartInstance = new Chart(ctx, {
        type: 'bar',
        data: {
          labels: mostPlayedSongs.map(([title]) => title.length > 20 ? title.substring(0, 20) + '...' : title),
          datasets: [{
            label: 'Play Count',
            data: mostPlayedSongs.map(([, song]) => song.playCount),
            backgroundColor: 'rgba(205, 99, 145, 0.8)',
            borderColor: '#cd6391',
            borderWidth: 1
          }]
        },
        options: {
          responsive: true,
          plugins: {
            legend: { display: false }
          },
          scales: {
            x: { 
              ticks: { color: '#fff', maxRotation: 45 },
              grid: { color: 'rgba(255, 255, 255, 0.1)' }
            },
            y: { 
              ticks: { color: '#fff' },
              grid: { color: 'rgba(255, 255, 255, 0.1)' }
            }
          }
        }
      });
    }

    function renderPlayTimeChart(playTimeDistribution) {
      const ctx = document.getElementById('playTimeChart').getContext('2d');
      
      if (window.playTimeChartInstance) window.playTimeChartInstance.destroy();

      window.playTimeChartInstance = new Chart(ctx, {
        type: 'doughnut',
        data: {
          labels: Object.keys(playTimeDistribution),
          datasets: [{
            data: Object.values(playTimeDistribution),
            backgroundColor: [
              'rgba(244, 67, 54, 0.8)',
              'rgba(255, 152, 0, 0.8)',
              'rgba(255, 235, 59, 0.8)',
              'rgba(76, 175, 80, 0.8)'
            ],
            borderColor: '#fff',
            borderWidth: 2
          }]
        },
        options: {
          responsive: true,
          plugins: {
            legend: { 
              position: 'bottom',
              labels: { color: '#fff' }
            }
          }
        }
      });
    }

    function renderActivityChart(dailyActivity) {
      const ctx = document.getElementById('activityChart').getContext('2d');
      
      if (window.activityChartInstance) window.activityChartInstance.destroy();

      const last7Days = Object.entries(dailyActivity)
        .slice(-7)
        .map(([date, count]) => ({
          date: new Date(date).toLocaleDateString('de-DE', { weekday: 'short', day: 'numeric' }),
          count
        }));

      window.activityChartInstance = new Chart(ctx, {
        type: 'line',
        data: {
          labels: last7Days.map(d => d.date),
          datasets: [{
            label: 'Songs Played',
            data: last7Days.map(d => d.count),
            borderColor: '#cd6391',
            backgroundColor: 'rgba(205, 99, 145, 0.1)',
            fill: true,
            tension: 0.4
          }]
        },
        options: {
          responsive: true,
          plugins: {
            legend: { display: false }
          },
          scales: {
            x: { 
              ticks: { color: '#fff' },
              grid: { color: 'rgba(255, 255, 255, 0.1)' }
            },
            y: { 
              ticks: { color: '#fff' },
              grid: { color: 'rgba(255, 255, 255, 0.1)' }
            }
          }
        }
      });
    }

    function renderFavoritesList(favoriteSongs) {
      const container = document.getElementById('favoritesList');
      
      if (favoriteSongs.length === 0) {
        container.innerHTML = '<div style="text-align: center; color: #ccc; padding: 2em;">No favorites yet. Complete more songs!</div>';
        return;
      }

      container.innerHTML = favoriteSongs.map(([title, song]) => `
        <div class="favorite-item">
          <div class="song-title">${title}</div>
          <div class="completion">${Math.round(song.avgCompletion)}% ‚Ä¢ ${song.playCount} plays</div>
        </div>
      `).join('');
    }

    function renderRecentActivity(recentLogs) {
      const container = document.getElementById('recentActivity');
      
      if (recentLogs.length === 0) {
        container.innerHTML = '<div style="text-align: center; color: #ccc; padding: 1em;">No recent activity</div>';
        return;
      }

      container.innerHTML = recentLogs.map(log => `
        <div class="activity-item">
          <div class="song-title">${log.title}</div>
          <div class="time">${new Date(log.timestamp).toLocaleString('de-DE')} ‚Ä¢ ${log.playPercentage}%</div>
        </div>
      `).join('');
    }

    function clearStats() {
      if (confirm('Are you sure you want to clear all statistics? This cannot be undone.')) {
        localStorage.removeItem('playedLog');
        playedLog = [];
        renderChart();
        alert('Statistics cleared successfully!');
      }
    }

    // Initialize the application
    loadVideos();
  </script>
</body>
</html>
