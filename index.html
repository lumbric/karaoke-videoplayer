<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title id="pageTitle"></title>
  <script src="theme-config.js"></script>
  <script src="static/chart.js"></script>
  <script src="https://www.youtube.com/iframe_api"></script>
  <script src="secret-config.js"></script> <!-- optional local secrets; ignored in git -->
  <script src="src/youtube.js"></script>
  <script src="src/main.js"></script>
  <link rel="stylesheet" href="src/common.css"> 
  <link id="themeStylesheet" rel="stylesheet" href="">
</head>
<body onload="main();">

  <!-- Cosmic/party decorative background elements -->
  <div class="cosmic-decoration" style="top: 10%; left: 5%;">â™ª</div>
  <div class="cosmic-decoration" style="top: 20%; right: 8%;">â˜…</div>
  <div class="cosmic-decoration" style="bottom: 15%; left: 10%;">â™«</div>
  <div class="cosmic-decoration" style="bottom: 25%; right: 15%;">â™¬</div>

  <div class="header-box">
    <div class="header-content">
      <h1 id="title"></h1>
      <img id="logo" src="" class="logo">
    </div>
    <div style="width: min(600px, 80%); margin: 0 auto; position: relative;">
      <div style="display: flex; gap: 10px; align-items: center; width: 100%;">
        <div style="position: relative; flex: 1;">
          <input type="text" id="search" placeholder="Lied suchen..." style="width: 100%;">
          <span id="selectedGenrePill"></span>
          <button id="clearSearchBtn" style="z-index: 100; position: absolute; right: -28px; top: 50%; transform: translateY(-50%); background: none; border: none; font-size: 1.4em; color: #a791b5; cursor: pointer; display: block;">&#10005;</button>
        </div>
        <button id="filterBtn" class="btn btn-primary" title="Genre">Genre</button>
        <button id="youtubeBtn" class="btn btn-primary" title="Online auf Youtbe Suchen">YouTube</button>
      </div>
      <div id="genreMenu" style="display: none; position: absolute; right: -330px; top: 90px; background: #fff; color: #4E4E4E; border-radius: 12px; box-shadow: 0 2px 12px #0003; min-width: 180px; z-index: 10; max-height: 260px; overflow-y: auto;">
        <div style="padding: 10px 18px; cursor: pointer; border-bottom: 1px solid #eee;" data-genre="">Alle Genres</div>
        <!-- genre options will be injected here -->
      </div>
    </div>
  </div>
  <div class="video-grid" id="videoList"></div>
  <div id="playerContainer">
    <button id="closeBtn" class="btn video-control-btn btn-close" onclick="closePlayer()">âœ•</button>
    <div class="video-overlay" id="videoOverlay">
      <button class="video-control-btn" id="playPauseBtn" onclick="togglePlayPause()">â¸ Pause</button>
      <button class="video-control-btn" onclick="restartVideo()">â†» Restart</button>
    </div>
    <video id="videoPlayer" autoplay disablepictureinpicture></video>
    <div id="youtubePlayer" class="hidden"></div>
  </div>
  <button id="statsButton" class="btn btn-primary">Stats</button>
  <div id="statsPage">
    <button id="closeStats" class="btn btn-close">âœ•</button>
    <div style="padding: 20px; max-width: 1200px; margin: 0 auto;">
      <h2 style="color: #cd6391; text-align: center; margin-bottom: 30px; font-size: 2.5em;">ğŸ“Š Karaoke Statistiken</h2>

      <!-- Statistics Summary Cards -->
      <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 40px;">
        <div class="stat-card">
          <h3>â™ª Total Songs</h3>
          <div class="stat-number" id="totalSongs">0</div>
        </div>
        <div class="stat-card">
          <h3>â± Total Play Time</h3>
          <div class="stat-number" id="totalPlayTime">0min</div>
        </div>
        <div class="stat-card">
          <h3>â˜… Most Played</h3>
          <div class="stat-number" id="mostPlayed">-</div>
        </div>
        <div class="stat-card">
          <h3>â†— Completion Rate</h3>
          <div class="stat-number" id="completionRate">0%</div>
        </div>
      </div>

      <!-- Large Most Played Chart -->
      <div class="chart-container" style="margin-bottom: 30px;">
        <h3>â™ª Most Played Songs (Top 15)</h3>
        <canvas id="mostPlayedChart" width="800" height="400"></canvas>
      </div>


      <!-- New Hourly Activity Chart -->
      <div class="chart-container" style="margin-bottom: 30px;">
        <h3>Activity Last 50 Hours (Completed vs Aborted)</h3>
        <canvas id="hourlyChart" width="800" height="400"></canvas>
      </div>

      <!-- Charts Container -->
      <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin-bottom: 30px;">
        <div class="chart-container">
          <h3>ï¿½ Completion Rate Distribution</h3>
          <canvas id="completionChart" width="400" height="250"></canvas>
        </div>
        <div class="chart-container">
          <h3>â° Play Time Distribution</h3>
          <canvas id="playTimeChart" width="400" height="300"></canvas>
        </div>
      </div>

      <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin-bottom: 30px;">
        <div class="chart-container">
          <h3>ğŸš« Most Skipped Songs (Low Completion)</h3>
          <div id="skippedList" style="max-height: 300px; overflow-y: auto;"></div>
        </div>
        <div class="chart-container">
          <h3>âš¡ Instant Skips (<30 seconds)</h3>
          <div id="instantSkipsList" style="max-height: 300px; overflow-y: auto;"></div>
        </div>
      </div>

      <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin-bottom: 30px;">
        <div class="chart-container">
          <h3>ğŸ’ Hidden Gems (Rare but Loved)</h3>
          <div id="hiddenGemsList" style="max-height: 300px; overflow-y: auto;"></div>
        </div>
        <div class="chart-container">
          <h3>ğŸ”„ Retry Songs (Often Restarted)</h3>
          <div id="retryList" style="max-height: 300px; overflow-y: auto;"></div>
        </div>
      </div>

      <!-- Recent Activity -->
      <div class="chart-container">
        <h3>ğŸ• Recent Activity</h3>
        <div id="recentActivity" style="max-height: 400px; overflow-y: auto;"></div>
      </div>

      <div style="text-align: center; margin-top: 30px;">
        <button onclick="exportStats()">ğŸ“ Export Data</button>
      </div>
    </div>
  </div>
</body>
</html>
